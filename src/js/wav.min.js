var $jscomp={scope:{},inherits:function(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;for(var c in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,c);e&&Object.defineProperty(a,c,e)}else a[c]=b[c]}},BaseWAVError=function(a){a=Error.call(this,a);this.message=a.message;"stack"in a&&(this.stack=a.stack);this.name=this.constructor.name;this.wav=null};$jscomp.inherits(BaseWAVError,Error);
var NullFileError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(NullFileError,BaseWAVError);var IncorrectFileTypeError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(IncorrectFileTypeError,BaseWAVError);var EmptyBufferError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(EmptyBufferError,BaseWAVError);var UnknownChunkIDError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(UnknownChunkIDError,BaseWAVError);
var IncorrectChunkSizeError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(IncorrectChunkSizeError,BaseWAVError);var UnknownFormatError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(UnknownFormatError,BaseWAVError);var IncorrectByteRateError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(IncorrectByteRateError,BaseWAVError);var IncorrectBlockAlignError=function(a){BaseWAVError.apply(this,arguments)};$jscomp.inherits(IncorrectBlockAlignError,BaseWAVError);
var WAV=function(a,b){this.file=a;this.reader=new FileReader;this._onAfterRead=b;this.reset()};
WAV.prototype.reset=function(){this.buffer=null;this.name=this.file&&this.file.name?this.file.name:"";this.lastModified=this.file&&this.file.lastModified?this.file.lastModified:"";this.lastModifiedDate=this.file&&this.file.lastModifiedDate?this.file.lastModifiedDate:"";this.size=this.file&&this.file.size?this.file.size:0;this.type=this.file&&this.file.type?this.file.type:"";this.chunkID="";this.chunkSize=0;this.subchunk1ID=this.format="";this.subchunk1Size=0;this.audioFormat="";this.extraParamSize=
this.bitsPerSample=this.blockAlign=this.byteRate=this.sampleRate=this.numberOfChannels=0;this.extraParams=null;this.subchunk2StartPos=0;this.subchunk2ID="";this.subchunk2Size=0;this.data=null;this.milliseconds=0;this.lastError=null};WAV.prototype.onAfterRead=function(){"function"===typeof this._onAfterRead&&this._onAfterRead(this)};WAV.prototype.error=function(a){a.wav=this;this.lastError=a;throw a;};WAV.prototype.onError=function(a){this.error(a)};WAV.prototype.onLoad=function(a){this.buffer=a.result};
WAV.prototype.onLoadEnd=function(a){this.chunkID=BufferHelper.asText(this.buffer,0,4);"RIFF"!==this.chunkID&&this.error(new UnknownChunkIDError("Unknown chunk ID: "+this.chunkID));this.chunkSize=BufferHelper.asInteger(this.buffer,4,4);this.chunkSize+8!==this.size&&this.error(new IncorrectChunkSizeError("Incorrect chunk size: "+this.chunkSize));this.format=BufferHelper.asText(this.buffer,8,4);"WAVE"!==this.format&&this.error(new UnknownFormatError("Unknown format: "+this.format));this.subchunk1ID=
BufferHelper.asText(this.buffer,12,4);"fmt "!==this.subchunk1ID&&this.error(new UnknownChunkIDError("Unknown ID for subchunk 1: "+this.subchunk1ID));this.subchunk1Size=BufferHelper.asInteger(this.buffer,16,4);16!==this.subchunk1Size&&18!==this.subchunk1Size&&this.error(new IncorrectChunkSizeError("Incorrect subchunk 1 size: "+this.subchunk1Size));this.audioFormat=BufferHelper.asInteger(this.buffer,20,2);this.numberOfChannels=BufferHelper.asInteger(this.buffer,22,2);this.sampleRate=BufferHelper.asInteger(this.buffer,
24,4);this.byteRate=BufferHelper.asInteger(this.buffer,28,4);this.blockAlign=BufferHelper.asInteger(this.buffer,32,2);this.bitsPerSample=BufferHelper.asInteger(this.buffer,34,2);this.byteRate!==this.sampleRate*this.numberOfChannels*BufferHelper.bitCountToByteCount(this.bitsPerSample)&&this.error(new IncorrectByteRateError("Incorrect byte rate: "+this.byteRate));this.blockAlign!==this.numberOfChannels*BufferHelper.bitCountToByteCount(this.bitsPerSample)&&this.error(new IncorrectBlockAlignError("Incorrect block align: "+
this.blockAlign));16<this.subchunk1Size&&(this.extraParamSize=BufferHelper.asInteger(this.buffer,36,2),0<this.extraParamSize&&(this.extraParams=BufferHelper.asInteger(this.buffer,38,this.extraParamSize)));this.subchunk2StartPos=20+this.subchunk1Size;this.subchunk2ID=BufferHelper.asText(this.buffer,this.subchunk2StartPos,4);"data"!==this.subchunk2ID&&this.error(new UnknownChunkIDError("Unknown ID for subchunk 2: "+this.subchunk2ID));this.subchunk2Size=BufferHelper.asInteger(this.buffer,this.subchunk2StartPos+
4,4);this.subchunk2Size!==this.chunkSize-this.subchunk2StartPos&&this.error(new IncorrectChunkSizeError("Incorrect subchunk 2 size: "+this.subchunk2Size));this.data=this.buffer.slice(this.subchunk2StartPos+8,this.subchunk2Size);this.milliseconds=this.subchunk2Size/BufferHelper.bitCountToByteCount(this.bitsPerSample)/this.sampleRate/this.numberOfChannels*1E3;this.onAfterRead()};
WAV.prototype.read=function(){this.reset();this.file||this.error(new NullFileError("Unknown file"));"audio/wav"!==this.type&&this.error(new IncorrectFileTypeError("Unknown file type: "+this.type));this.reader.onload=this.onLoad.bind(this,this.reader);this.reader.onloadend=this.onLoadEnd.bind(this,this.reader);this.reader.onerror=this.onError.bind(this);this.reader.readAsArrayBuffer(this.file)};
